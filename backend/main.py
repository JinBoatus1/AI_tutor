from fastapi import FastAPI, File, UploadFile, Formfrom fastapi.middleware.cors import CORSMiddlewarefrom pydantic import BaseModelfrom typing import List, Dictimport openaiimport os, base64from dotenv import load_dotenvload_dotenv()app = FastAPI()app.add_middleware(    CORSMiddleware,    allow_origins=["*"],    allow_credentials=True,    allow_methods=["*"],    allow_headers=["*"],)class ChatMessage(BaseModel):    message: str    history: List[Dict[str, str]] = []@app.get("/")async def root():    return {"message": "AI Tutor Backend running", "status": "ok"}@app.post("/api/chat")async def chat(chat_message: ChatMessage):    api_key = os.getenv("API_KEY")    client = openai.OpenAI(api_key=api_key)    system_prompt = (        "You are an AI math tutor using Polyaâ€™s method. "        "Guide students step by step, never reveal full answers."    )    messages = [{"role": "system", "content": system_prompt}]    for m in chat_message.history:        messages.append({"role": m["role"], "content": m["content"]})    messages.append({"role": "user", "content": chat_message.message})    response = client.chat.completions.create(        model="gpt-4o-mini",        messages=messages,        max_tokens=400,        temperature=0.7,    )    return {"reply": response.choices[0].message.content}from typing import Listfrom typing import List@app.post("/api/grade")async def grade(    prompt: str = Form(...),    text: str = Form(""),    files: List[UploadFile] = File(None)):    api_key = os.getenv("API_KEY")    client = openai.OpenAI(api_key=api_key)    user_content = []    if text.strip():        user_content.append({"type": "text", "text": text})    if files:        for file in files:            b64 = base64.b64encode(await file.read()).decode("utf-8")            user_content.append({                "type": "image_url",                "image_url": {"url": f"data:image/png;base64,{b64}"}            })    resp = client.chat.completions.create(        model="gpt-4o-mini",        messages=[            {"role": "system", "content": prompt},            {"role": "user", "content": user_content},        ],    )    return {"reply": resp.choices[0].message.content}if __name__ == "__main__":    import uvicorn    uvicorn.run(app, host="0.0.0.0", port=8000)